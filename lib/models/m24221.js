
//	Основи на Компютърната Графика
//	Модел 24221 - Хоризонтално отместване на контролни точки
//	П. Бойчев, 2017


// конструктор на модела
MEIRO.Models.M24221 = function M24221(room)
{
	MEIRO.Model.apply(this, arguments);

	var map = new THREE.TextureLoader().load('data:image/jpeg;base64,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');
	map.anisotropy = 16;

	// екран
	this.screen = new MEIRO.Screen(12,8);
	
	// пръстени, линии и блокове
	this.object = new MEIRO.Bezier3D(3);
	this.object.material = new THREE.MeshBasicMaterial({map:map,side:THREE.DoubleSide,color:'ghostwhite'});
	this.points = [[],[],[]];
	for (var i=0; i<3; i++)
	for (var j=0; j<3; j++)
	{
		this.points[i][j] = new MEIRO.Point();
		this.points[i][j].position.set(3*i-3,3*j-3,0.1);
		this.object.surface.controlPoints[i][j].copy(this.points[i][j].position);
	}
	this.object.recalculate();
	
	// бутон за превключване
	var that = this;
	this.toggle = new MEIRO.CornerButton('topLeft', function(){that.onToggle();}, 'Отначало', 'images/toggle.png');
	this.toggle.hide();
	this.onToggle();

	this.raycaster = new THREE.Raycaster();
	this.mouse = new THREE.Vector2();
	
	// сглобяване на целия модел
	this.image.add(this.object,this.screen);
	for (var i=0; i<3; i++)
	for (var j=0; j<3; j++)
		this.image.add(this.points[i][j]);
}

MEIRO.Models.M24221.prototype = Object.create(MEIRO.Model.prototype);

MEIRO.Models.M24221.DIST = {MIN:10, MAX:30, HEIGHT:0};
MEIRO.Models.M24221.POS = {DIST:15, ROT_X:Math.PI/2, ROT_Y:0};
MEIRO.Models.M24221.ROT_Y = {MIN:-0.1, MAX:0.7};


MEIRO.Models.M24221.prototype.onObjectPos = function()
{
	// координати на мишка
	this.mouse.x = (controls.human.mousePos.x/window.innerWidth)*2 - 1;
	this.mouse.y = -(controls.human.mousePos.y/window.innerHeight)*2 + 1;

	this.raycaster.setFromCamera( this.mouse, camera );
	var intersects = this.raycaster.intersectObject( this.screen.plate );
	if (intersects.length)
	{
		var p = intersects[0].point;
		p.sub(this.image.position).divide(this.image.scale);
		return p;
	}
	return undefined;
}


MEIRO.Models.M24221.prototype.onObject = function()
{
	// координати на мишка
	this.mouse.x = (controls.human.mousePos.x/window.innerWidth)*2 - 1;
	this.mouse.y = -(controls.human.mousePos.y/window.innerHeight)*2 + 1;

	this.raycaster.setFromCamera( this.mouse, camera );
	var intersects = this.raycaster.intersectObject( this.screen.plate );
	if (intersects.length)
	{
		var p = intersects[0].point;
		p.sub(this.image.position).divide(this.image.scale);

		// кой е най-близо до p?
		var minI = -1;
		var minJ = -1;
		var minDist = 100;
		for (var i=0; i<3; i++)
		for (var j=0; j<3; j++)
		{
			var dist = p.distanceTo(this.points[i][j].position);
			if (dist<minDist)
			{
				minDist = dist;
				minI = i;
				minJ = j;
			}
		}
		if (minDist>=0 && minDist<0.25)
		{
			this.dragI = minI;
			this.dragJ = minJ;
			return p;
		}
	}
	return undefined;
}


// интерактор на модела
MEIRO.Models.M24221.prototype.onDragMove = function()
{
	var p = this.onObjectPos();
	if (p)
	{
		this.points[this.dragI][this.dragJ].position.set(p.x,p.y,0.1);
		for (var i=0; i<3; i++)
		for (var j=0; j<3; j++)
		{
			this.object.surface.controlPoints[i][j].copy(this.points[i][j].position);
		}
		
		this.object.recalculate();
	}
}


// аниматор на модела
MEIRO.Models.M24221.prototype.onAnimate = function(time)
{
	TWEEN.update();
	
	//reanimate();
}



// информатор на модела
MEIRO.Models.M24221.prototype.onInfo = function(element)
{
	var s = '';
	s += '<h1>Хоризонтално отместване на контролни точки</h1>';

	s += '<p>Контролните точки, описващи повърхност на Безие или NURBS повърхност, могат да са на произволни места в пространството. Ако те са в една равнина, но не са във върховете на правилна мрежа, получената повърхност ще е деформирана, но все пак равнинна.</p>';
	element.innerHTML = s;
}



// превключвател на модела
MEIRO.Models.M24221.prototype.onToggle = function(element)
{
	var that = this;
	new TWEEN.Tween({k:0})
		.to({k:1},1000)
		.easing( TWEEN.Easing.Quadratic.InOut )
		.onUpdate( function()
			{
				for (var i=0; i<3; i++)
				for (var j=0; j<3; j++)
				{
					var p = new THREE.Vector3(3*i-3,3*j-3,0.1);
					that.points[i][j].position.lerp(p,this.k);
					that.object.surface.controlPoints[i][j].copy(that.points[i][j].position);
				}
				that.object.recalculate();
			})
		.start();
		
	reanimate();
}