<!DOCTYPE html>

<html>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<head>
		<link rel="stylesheet" type="text/css" href="css/meiro.css">
		<link rel="stylesheet" type="text/css" href="css/meiro.doc.css">
		<script>
			function main()
			{
				var h2 = document.getElementsByTagName('h2');
				for (var i=0; i<h2.length; i++)
				{
					h2[i].style.cursor = 'pointer';
					h2[i].nextElementSibling.style.display = 'none';
					h2[i].onclick = function (event)
					{
						var elem = event.target.nextElementSibling;
						if (elem.style.display=='none')
							elem.style.display='block';
						else
							elem.style.display='none';
					}
				}
			}
		</script>
	</head>
	
	<body onload="main()">
		<div class="infoPanel">
			<h1>Документация</h1>
			<p>Това е кратка техническа документация. За подробности трябва да се гледат сорс-файловете. Те са обилно напръскани с коментари.</p>

			<h2>Външни параметри</h2>
			<div>
				<p>Повечето модули комуникират помежду си чрез параметри, подавани в URL.</p>
				<ul>
					<li><code>id</code> &ndash; номер на лабиринта, цяло или дробно число, което се използва за инициализация на генератора на случайни числа. Ако е нула или липсва се ползва случайно избран номер.</li>
					<li><code>size</code> &ndash; размер на лабиринта, стринг от три цели числа &ndash; <em>X</em>, <em>Y</em> и <em>Z</em>, разделени с x-ове. <em>X</em> и <em>Z</em> са хоризонталните размери на лабиринта, а <em>Y</em> е броят етажи. По подразбиране е 20x3x15.</li>
					<li><code>stairs</code> &ndash; желан, но негарантиран, брой стълби между два съседни етажа. По подразбиране е 5.</li>
					<li><code>split</code> &ndash; разделяне на лабиринта, стринг от три числа &ndash; <em>minRoom</em>, <em>maxRoom</em> и <em>extraDoors</em>, разделени с x-ове. <em>minRoom</em> е цяло число за минималния размер на остатъчна стая при рязане на стая на две. Ако стая е с размер по-голям от <em>maxRoom</em> (също цяло число), то тя ще бъде разделена. <em>extraDoors</em> е дробно число, което се умножава с дължината на стена и определя колко най-много случайни допълнителни врати ще има, освен задължителната една врата. По подразбиране е 3x8x0.1.</li>
					<li><code>pos</code> &ndash; начална позиция на играча, стринг от четири дробни числа &ndash; <em>X</em>, <em>Y</em>, <em>Z</em> и <em>Angle</em>, разделени с x-ове. <em>X</em> и <em>Z</em> са хоризонталните координати в лабиринта, <em>Y</em> е на кой етаж е играчът (ако е дробно число, играчът е на стълби между етажи), а <em>Angle</em> е посоката на гледане представена като ъгъл в радиани. Няма стойност по подразбиране.</li>
					<li><code>zoom</code> &ndash; диапазон на максимално приближаване или отдалечаване в режим на карта. Ако е 10, то образът може да се мащабира от x0.1 до x10. По подразбиране е 1.</li>
					<li><code>texture</code> &ndash; параметър за използвани текстури за лабиринта, стринг. Ако е <em>no</em>, <em>none</em> или <em>false</em> не се ползват текстури. Ако е <em>yes</em>, <em>true</em> или <em>default</em> се ползва основната текстура (сини линии на фон на точки). Ако е <em>debug</em> или <em>grid</em> се ползва текстурата по подразбиране с насложена квадратна координатна мрежа. Стойността по подразбиране е <em>true</em>.</li>
					<li><code>ao</code> &ndash; параметър за използвано околно засенчване (ambient occlusion). Ако е <em>no</em>, <em>none</em> или <em>false</em> не се ползва засенчване. Ако е <em>yes</em>, <em>true</em>, <em>default</em> или <em>fssao</em> се ползва основното засенчване с фалшиво SSAO. Ако е <em>sao</em>, <em>ssao</em> или <em>nnsao</em> се ползва съответно SAO, SSAO или NNSAO засенчване. Стойността по подразбиране е <em>fssao</em>.</li>
					<li><code>modeloverlay</code> &ndash; параметър без стойност, самото му съществуване предизвиква рисуване на модела в стая над образа на стаята (дори и след евентуално околно засенчване) &ndash; по-красив модел, но е насложен над лабиринта. Ако липсва, моделът се рисува вътре в сцената и при някои засенчвания се получават ореоли.</li>
					<li><code>lowpoly</code> &ndash; параметър без стойност, самото му съществуване предизвиква генериране на обекти с по-малко стени. Ако липсва, стените са повече на брой и обектите са по-гладки.</li>
					<li><code>back</code> &ndash; URL адрес, на който да се премине след излизане от текущата страница. Например, <em>blueprint.html</em> го използва, за да се върне обратно към <em>player.html</em>. Няма стойност по подразбиране.</li>
					<li><code>model</code> или <code>models</code> &ndash; списък от имена на модели, които да се заредят и разпределят по стаите на лабиринта. Имената са разделени със запетайки, например: <em>m00001,m00002,m00003</em>. Няма стойност по подразбиране.</li>
					<li><code>lang</code> &ndash; език на показваните текстове: <em>en</em> или <em>bg</em>. По подразбиране е <em>en</em>.</li>
				</ul>
			</div>
			
			<h2>Навигация</h2>
			<div>
				<p>Ако лабиринтът се гледа отгоре, навигацията е в стил обикаляне около лабиринта:
					<ul><li>Клавиатура &ndash; въртене със стрелки или WASD, мащабиране с PgUp/PgDn или QE.</li>
						<li>Мишка &ndash; въртене с ляв бутон, мащабиране с десен бутон.</li>
						<li>Пръсти &ndash; въртене с един пръст, мащабиране с два пръста.</li>
					</ul>
				</p>
				<p>Ако лабиринтът се гледа отвътре:
					<ul><li>Клавиатура &ndash; въртене наляво-надясно и движение напред-назад със стрелки или WASD, гледане нагоре-надолу с PgUp/PgDn или QE.</li>
						<li>Мишка &ndash; въртене и движение с ляв бутон, само въртене с десен бутон.</li>
						<li>Пръсти &ndash; въртене и движение с един пръст, само въртене с два пръста.</li>
					</ul>
				</p>
			</div>
			
			<h2>Структура на лабиринтa</h2>
			<div>
				<p>Лабиринтът се генерира рекурсивно чрез случайно разделяне на правоъгълна зона на две по-малки и слагане поне на една врата между тях. Модулът за генериране е <code>lib/dungeon.js</code> и той не се занимава с генериране на образа. Настройките се получават през параметри от URL.</p>
				<p>Целият лабиринт е <code>Dungeon</code>, а отделните му етажи са <code>DungeonLevel</code>. Стаи, стени, врати и стълби са прикачени към съответния етаж.</p>
				<p>Конкретната структура може да се види като се пусне някой от модулите. В конзолата се показва дървото на инстанцията <code>MEIRO.Dungeon</code>.
			</div>
			
			<h2>Карта на лабиринта</h2>
			<div>
				<p>Този режим на работа ще се ползва от играча за ориентация. С него може да се разгледа архитектурата на целия лабиринт - стаи, врати, стълби, но не и детайли по съдържанието на стаите. Реализира се с модула <code>blueprint.html</code> и <code>lib/dungeon.blueprint.js</code>, като очаква лабиринтът да е предварително създаден чрез <code>lib/dungeon.js</code>.</p>
				<p>Настройките получава през параметри от URL. Ако е зададена позиция на играча (параметър <code>pos</code>), мястото се маркира с геомаркер, а етажът се показва по подразбиране. Иначе няма геомаркер и се показва най-долният етаж.</p>
			</div>
			
			<h2>Файлове</h2>
			<dir>
				<ul>
					<li><code>.</code> - най-вече главните <code>*.html</code> файлове</li>
					<li><code>lib</code> - вътрешни библиотеки, собствено производство</li>
					<li><code>libx</code> - леко пипнати външни библиотеки, да не се подменят с лека ръка с по-нови версии</li>
					<li><code>css</code> - папка за каскадни стилове</li>
					<li><code>images</code> - папка за картинки, ползват се само <code>*.min.png</code></li>
				</ul>
			</dir>
		</div>
	</body>
</html>